<mat-card>
  <mat-card-title>
    Audit #{{id}}
    <mat-icon id="questionanswericon" class="position-right" (click)="drawer.toggle()">
      question_answer
    </mat-icon>
  </mat-card-title>
  <mat-drawer-container class="comment-container">
    <mat-drawer #drawer class="comment" mode="side" position="end">
      <div class="comment">
        <div class="comment-header" fxLayoutAlign="center">
          <h2>Comment Board</h2>
        </div>
        <div id="comment-history" class="comment-history">
          <div *ngFor="let comment of comments">
            <div class="comment-text">
              {{comment}}
            </div>
          </div>
        </div>

        <div class="comment-message">
          <form>
            <mat-form-field class="comment-input">
              <mat-label>Enter Comment</mat-label>
              <input matInput type="text" [(ngModel)]="comment_value" [ngModelOptions]="{standalone: true}" rows="1">
              <button mat-button *ngIf="comment_value" matSuffix mat-icon-button aria-label="Comment"
                      (click)="this.comment()">
                <mat-icon id="sendicon">send</mat-icon>
              </button>
            </mat-form-field>
          </form>
        </div>

      </div>
    </mat-drawer>
    <mat-drawer-content>

  <!-- AUDIT INFORMATION -->
  <mat-expansion-panel class="mat-expand"
                       expanded='true'
                       hideToggle="true"
                       #stateAI="matExpansionPanel">

      <mat-expansion-panel-header class="tableHead">
        <mat-card-header>
          <mat-card-title >Audit Information</mat-card-title>
        </mat-card-header>
        <mat-panel-description>
          <mat-icon *ngIf="stateAI.expanded">keyboard_arrow_down</mat-icon>
          <mat-icon *ngIf="!stateAI.expanded">keyboard_arrow_right</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header>


      <table class="tableLayout" aria-describedby="audit" mat-table *ngIf="dataSource" [dataSource]="metaDataSource" matSort>
        <ng-container *ngFor="let column of displayedMetaColumns" [matColumnDef]="column">
          <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ column.replaceAll('_', ' ') | titlecase }}</th>


          <td mat-cell *matCellDef="let object">
            <div *ngIf="column == 'status'; else elseBlock"
                 [ngClass]="{'pending-audit' : (object[column] == 'Pending'),
                             'active-audit' : (object[column] == 'Active'),
                             'complete-audit' : (object[column] == 'Complete')}">
                  {{ object[column]}}
            </div>
            <ng-template #elseBlock>
              {{ object[column]}}
            </ng-template>
          </td>

        </ng-container>



          <tr mat-header-row *matHeaderRowDef="displayedMetaColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedMetaColumns;"></tr>
      </table>
    </mat-expansion-panel>

    <!-- SELECTED ITEMS -->
    <mat-expansion-panel class="mat-expand"
                       expanded='true'
                       hideToggle="true"
                       #stateSI="matExpansionPanel">

      <mat-expansion-panel-header class="tableHead">
        <mat-card-header>
          <mat-card-title >Selected Items</mat-card-title>
        </mat-card-header>
        <mat-panel-description>
          <mat-icon *ngIf="stateSI.expanded">keyboard_arrow_down</mat-icon>
          <mat-icon *ngIf="!stateSI.expanded">keyboard_arrow_right</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header>


      <table class="tableLayout" aria-describedby="audit" mat-table *ngIf="dataSource" [dataSource]="dataSource" matSort>

  <!--      CHECKBOX TO EXPORT SPECIFIC ITEMS
        <ng-container matColumnDef="Select">
          <th scope="col" mat-header-cell *matHeaderCellDef>Select</th>
          <td mat-cell *matCellDef="let object">
            <mat-checkbox  (change)='onChange(object["audit_id"])' [id]="'checkBox' + object['audit_id']"></mat-checkbox>
          </td>
        </ng-container> -->


        <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
          <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header>{{ column.replaceAll('_', ' ') }}</th>
          <td mat-cell *matCellDef="let object">
              {{ object[column]}}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>
    </mat-expansion-panel>

    <!-- RESULTS -->
    <mat-expansion-panel *ngIf="!hideResult"
                         class="mat-expand"
                         expanded='true'
                         hideToggle="true"
                         #stateR="matExpansionPanel">

      <mat-expansion-panel-header>
        <mat-card-header class="tableHead">
          <mat-card-title>Results</mat-card-title>
        </mat-card-header>

        <mat-panel-description>
          <mat-icon *ngIf="stateR.expanded">keyboard_arrow_down</mat-icon>
          <mat-icon *ngIf="!stateR.expanded">keyboard_arrow_right</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header>

      <table class="tableLayout" aria-describedby="audit" mat-table
             *ngIf="resultsDataSource" [dataSource]="resultsDataSource" matSort>

        <ng-container *ngFor="let column of resultsDisplayedColumns" [matColumnDef]="column">
          <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header>
            {{ column.replaceAll('_', ' ') | titlecase }}</th>
          <td mat-cell *matCellDef="let object"
                [ngClass]="{'missing-result' : (column == 'status' && object[column] == 'Missing'),
                            'provided-result' : (column == 'status' && object[column] == 'Provided'),
                            'new-result': (column == 'status' && object[column] == 'New')}">
              {{ object[column] }}
          </td>
        </ng-container>


        <tr mat-header-row *matHeaderRowDef="resultsDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: resultsDisplayedColumns;"></tr>
      </table>
    </mat-expansion-panel>
  <br><br>

    <mat-paginator
      [length]="length"
      [pageSize]="pageSize"
      [pageSizeOptions]="[25,50,100]"
      [pageIndex]="pageIndex"
      (page)="paginatorAction($event)">
    </mat-paginator>

    </mat-drawer-content>
  </mat-drawer-container>
  
</mat-card>
